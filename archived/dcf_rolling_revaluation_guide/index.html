<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>DCF 滚动重评实践指南（季度/中报更新版） - My Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">01 project overview</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../01_project_overview/" class="dropdown-item">项目概览文档</a>
</li>
                                    
<li>
    <a href="../../01_project_overview/project_analysis_report/" class="dropdown-item">股票估值系统项目分析报告</a>
</li>
                                    
<li>
    <a href="../../01_project_overview/project_status_2025_09_latest/" class="dropdown-item">股票估值系统项目状态报告</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">02 architecture</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../02_architecture/" class="dropdown-item">架构设计文档</a>
</li>
                                    
<li>
    <a href="../../02_architecture/dcf_architecture/" class="dropdown-item">DCF 核心业务逻辑与架构</a>
</li>
                                    
<li>
    <a href="../../02_architecture/hybrid_architecture_design/" class="dropdown-item">股票估值系统混合架构设计文档</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">03 development</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../03_development/" class="dropdown-item">开发文档</a>
</li>
                                    
<li>
    <a href="../../03_development/development_guide_2025_09/" class="dropdown-item">股票估值系统开发指南</a>
</li>
                                    
<li>
    <a href="../../03_development/testing_strategy_2025_09/" class="dropdown-item">测试策略与质量保障指南</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">04 deployment</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../04_deployment/" class="dropdown-item">部署运维文档</a>
</li>
                                    
<li>
    <a href="../../04_deployment/deployment_operations_guide_2025_09/" class="dropdown-item">部署运维指南</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">05 data sources</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../05_data_sources/" class="dropdown-item">数据源专题文档</a>
</li>
                                    
<li>
    <a href="../../05_data_sources/tushare_alignment/" class="dropdown-item">TuShare数据源对齐与生产部署报告</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Archived</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">归档文档</a>
</li>
                                    
<li>
    <a href="../Stock_investment_decision_making_process/" class="dropdown-item">Stock investment decision making process</a>
</li>
                                    
<li>
    <a href="../api_backend_comprehensive_analysis/" class="dropdown-item">Stock Valuation API 后端接口详细分析文档</a>
</li>
                                    
<li>
    <a href="../dcf_industry_standards_comprehensive_analysis/" class="dropdown-item">DCF估值项目与行业标准深度对比分析报告</a>
</li>
                                    
<li>
    <a href="../dcf_optimization_plan/" class="dropdown-item">DCF 核心业务逻辑优化方案（v1）</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">DCF 滚动重评实践指南（季度/中报更新版）</a>
</li>
                                    
<li>
    <a href="../directory_optimization_plan/" class="dropdown-item">项目目录结构优化方案</a>
</li>
                                    
<li>
    <a href="../mckinsey_financial_ratios_and_forecasting_analysis/" class="dropdown-item">Stock Vale Valuation 3.0 财务比率与预测逻辑 McKinsey 标准合规性专题分析报告</a>
</li>
                                    
<li>
    <a href="../mckinsey_standards_compliance_report/" class="dropdown-item">Stock Vale Valuation 3.0 项目 McKinsey 标准合规性分析报告</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../dcf_optimization_plan/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../directory_optimization_plan/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#dcf" class="nav-link">DCF 滚动重评实践指南（季度/中报更新版）</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#_1" class="nav-link">结论速览</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_2" class="nav-link">重评的两种方式</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_3" class="nav-link">关键口径与公式</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_4" class="nav-link">在当前系统如何操作</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_5" class="nav-link">基期现金的选取（重评必读）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#ltm12" class="nav-link">LTM（过去12个月）支持</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#2025-09-10" class="nav-link">口径与显示（2025-09-10 更新）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#wacc" class="nav-link">何时选哪种 WACC 权重更科学</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_6" class="nav-link">常见陷阱与建议</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#checklist" class="nav-link">重评清单（Checklist）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#api-ui" class="nav-link">API 字段速查（与 UI 对应）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="dcf">DCF 滚动重评实践指南（季度/中报更新版）</h1>
<h2 id="_1">结论速览</h2>
<ul>
<li>季报/中报发布后 <strong>可以且建议进行滚动重评</strong>。核心是把“估值日”与“基期口径”同步到最新报表，然后用一致口径重算经营与资本结构两条线。</li>
<li>“基期现金”用于 EV→Equity 桥的净债务计算，应取 <strong>估值日的现金及现金等价物</strong>（剔除受限现金），而不是平均值或年末数。</li>
<li>本项目已支持滚动重评的关键要素：</li>
<li>年中折现（Mid-Year Convention）</li>
<li>WACC 增强 CAPM（CRP/IRP）与“目标/市场价值”两种权重模式</li>
<li>NWC 分项口径基期（<code>last_component_nwc</code>）与日数平滑过渡（<code>nwc_days_transition_years</code>）</li>
<li>股权桥以“最新资产负债表”一行计算净债务</li>
<li>股息与 as-of 展示（2025-09-10）：</li>
<li>TTM 股息优先采用“实施/完成”，没有则“TTM·预案”，仍没有则“年度最近一次”；UI 标签同步标注来源</li>
<li>最新价格按 <code>trade_date ≤ 估值日</code> 回退，EPS（年报）按 <code>end_date ≤ 估值日</code> 回退；基本信息中显示 as-of</li>
<li>若要“完全 LTM（过去12个月）基期”的经营滚动，需要很小的抓取与处理扩展；当前已可实现“资本结构滚动+年中折现+NWC平滑”的规范重评。</li>
</ul>
<h2 id="_2">重评的两种方式</h2>
<ul>
<li>快速重评（仅市场侧滚动）</li>
<li>估值日设到季报/中报披露后，更新：股价/总股本（E）、Rd/Rf/β/MRP/CRP/IRP、终值假设；勾选年中折现。</li>
<li>EV 变化主要受 WACC 与 TV 驱动；净债务与经营基期仍是上次年报口径（快速但粗略）。</li>
<li>规范重评（经营+资本结构滚动）</li>
<li>估值日设到季报/中报披露日（或接近的交易日）。</li>
<li>NWC 基期用分项口径 <code>last_component_nwc</code>，并设置 <code>nwc_days_transition_years</code>（建议 3 年）从 <code>last_*_days</code> → 历史中位数日数平滑过渡，避免首年 ΔNWC 跳变。</li>
<li>净债务：以“最新资产负债表”一行的 <strong>有息债务 − 现金及现金等价物</strong> 计算（估值日口径）。</li>
<li>勾选年中折现；TV 参数按最新判断重估。</li>
</ul>
<h2 id="_3">关键口径与公式</h2>
<ul>
<li>UFCF 不含现金：NWC 以经营性科目计算（现金不进 NWC）。</li>
<li>净债务（估值日）：<code>NetDebt = Interest-bearing Debt − Cash &amp; Equivalents</code>。</li>
<li>WACC：</li>
<li><code>Ke = Rf + β × (MRP + CRP) + Size + IRP</code></li>
<li><code>Kd_AT = Kd × (1 − Tax)</code>（建议用边际税率；系统当前用目标有效税率）</li>
<li><code>WACC = w_e × Ke + w_d × Kd_AT</code></li>
<li>权重模式：<ul>
<li>目标结构：<code>w_d = target_debt_ratio</code>，<code>w_e = 1 − w_d</code>。</li>
<li>市场价值：<code>w_d = D/(D+E)</code>（<code>E=市值=股价×总股本</code>；<code>D≈有息债账面值近似市场价值</code>）。</li>
</ul>
</li>
<li>折现时点：可启用年中折现（Mid-Year），等价于指数用 <code>(year − 0.5)</code>。</li>
</ul>
<h2 id="_4">在当前系统如何操作</h2>
<ul>
<li>估值日：在 UI 选择中报/季报之后的日期（或你指定的估值日）。</li>
<li>勾选“使用年中折现（mid_year_convention）”。</li>
<li>NWC 基准口径：选择 <code>component</code>（分项口径，推荐），并设置“天数过渡年数”=3（可调）。</li>
<li>WACC 权重模式：</li>
<li>若强调贴近现状，选“使用最新市场价值计算权重（market）”。</li>
<li>若结构预计回归常态/目标，选“使用目标债务比例（target）”。</li>
<li>CRP/IRP：根据公司市场/行业设置（.env 或 UI 输入），Ke 将自动纳入。</li>
<li>终值方法：退出乘数或永续增长率按最新判断设定（后续将加入名义 GDP 上限校验与常驻提示）。</li>
<li>调试区检查：</li>
<li>请求载荷摘录（含 <code>nwc_baseline_mode</code>、<code>nwc_days_transition_years</code>、<code>mid_year_convention</code>）</li>
<li>映射后假设、历史中位数（含 <code>last_component_nwc</code>、<code>last_*_days</code>）</li>
<li>首年预测关键项（<code>delta_nwc</code>、<code>ufcf</code> 等）</li>
</ul>
<h2 id="_5">基期现金的选取（重评必读）</h2>
<ul>
<li>取“估值日时点”的现金及现金等价物（剔除受限现金）。</li>
<li>若只有年末现金，可用：<code>期初现金 + 自由现金流（YTD 经营/投资/筹资净额） ± 重大事项</code> 回滚至估值日。</li>
<li>与 NWC 一致性：现金不进 NWC，使用分项 NWC 基期即可消除 ΔNWC 的口径跳变。</li>
</ul>
<h2 id="ltm12">LTM（过去12个月）支持</h2>
<ul>
<li>end_type 口径映射：<code>1=Q1</code>、<code>2=H1</code>、<code>3=Q3</code>、<code>4=年度</code>（均为当年 YTD 口径）。</li>
<li>新增 UI/API 开关：<code>ltm_baseline_enabled</code>（默认 False）。开启后：</li>
<li>经营基期（last_actual_revenue）采用 LTM 换算：<ul>
<li>若最新为年报（end_type=4）：LTM=当年年报；</li>
<li>若为 1/2/3：<code>LTM = YTD_curr + (Annual_prev − YTD_prev)</code>（分别对 <code>revenue</code> 与 <code>total_revenue</code> 计算，优先采用 <code>revenue</code>）。</li>
</ul>
</li>
<li>资本结构与 NWC 基期：<code>latest_balance_sheet</code> 指向估值日之前最近一期；<code>last_component_nwc</code> 基于该行重算，避免首年口径跳变。</li>
<li>回退策略：如缺上年同口径（YTD_prev）或上年年报（Annual_prev），则回退为“年报基期”；调试区会提示。</li>
<li>保持一致性：</li>
<li>历史中位数（比率/周转）仍基于年报历史序列提取；</li>
<li>首年 <code>last_*_days</code> 使用历史中位数并按设置过渡年数从“最新一期实际值”平滑（如可得）。</li>
</ul>
<p>备注：不开启 LTM 时，系统沿用“年报基期 + 最新资产负债表 + 年中折现 + NWC 平滑”的规范重评。</p>
<h2 id="2025-09-10">口径与显示（2025-09-10 更新）</h2>
<ul>
<li>基本信息 caption 显示：收入基期（LTM/年报）+ 资产负债表基准日</li>
<li>最新价格标签：带 as-of（估值日或小于等于估值日的最近交易日）</li>
<li>每股收益标签：显示“年报YYYY”（≤估值日的最近年报年份）</li>
<li>股息标签：依据来源显示“(TTM)/(TTM·预案)/(年度)”</li>
</ul>
<h2 id="wacc">何时选哪种 WACC 权重更科学</h2>
<ul>
<li>市场价值权重（market）：贴近现状的即期估值；但受市价波动影响大。</li>
<li>目标债务比例（target）：适合结构将回归目标/行业均衡、或现状明显偏离的情况。</li>
<li>最佳实践：两者交叉核对；若差异显著，建议做敏感性分析并说明理由。</li>
</ul>
<h2 id="_6">常见陷阱与建议</h2>
<ul>
<li>不要用“资产负债率”（账面口径）代替 WACC 中的“债务比例”（市值口径的有息债权重）。</li>
<li>不要用平均现金或年末现金代替“估值日现金”；股权桥中的净债务必须是估值日口径。</li>
<li>年中不改估值日而直接插入中报数据，会造成时间错配；建议切估值日或使用年中折现/短期分段（stub）。</li>
<li>纳入租赁负债（IFRS16）时，要与 UFCF/EBITDA 口径配套，避免双重调整或遗漏。</li>
</ul>
<h2 id="checklist">重评清单（Checklist）</h2>
<ul>
<li>[ ] 估值日选择并对齐所有数据</li>
<li>[ ] mid_year_convention 勾选</li>
<li>[ ] nwc_baseline_mode=component；nwc_days_transition_years=3（建议）</li>
<li>[ ] WACC 权重模式与 Ke 参数（Rf/β/MRP/CRP/IRP）更新</li>
<li>[ ] 终值参数（退出乘数/PGR）更新；（后续：名义 GDP 上限校验）</li>
<li>[ ] 净债务：估值日有息债务与现金（剔除受限）口径一致</li>
<li>[ ] 调试区：请求/映射/历史中位数/首年预测核对 ΔNWC 与 UFCF 合理性</li>
</ul>
<h2 id="api-ui">API 字段速查（与 UI 对应）</h2>
<ul>
<li><code>mid_year_convention: bool</code></li>
<li><code>ltm_baseline_enabled: bool</code></li>
<li><code>nwc_baseline_mode: component|aggregate</code></li>
<li><code>nwc_days_transition_years: int</code></li>
<li><code>wacc_weight_mode: market|target</code>, <code>target_debt_ratio</code></li>
<li><code>cost_of_debt</code>, <code>risk_free_rate</code>, <code>beta</code>, <code>market_risk_premium</code>, <code>country_risk_premium</code>, <code>industry_risk_premium</code></li>
<li><code>terminal_value_method: exit_multiple|perpetual_growth</code>, <code>exit_multiple</code>, <code>perpetual_growth_rate</code></li>
</ul>
<hr />
<p>最后更新：2025-09-10</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
