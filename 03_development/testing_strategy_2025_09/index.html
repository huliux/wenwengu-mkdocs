<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>测试策略与质量保障指南 - My Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">01 project overview</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../01_project_overview/" class="dropdown-item">项目概览文档</a>
</li>
                                    
<li>
    <a href="../../01_project_overview/project_analysis_report/" class="dropdown-item">股票估值系统项目分析报告</a>
</li>
                                    
<li>
    <a href="../../01_project_overview/project_status_2025_09_latest/" class="dropdown-item">股票估值系统项目状态报告</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">02 architecture</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../02_architecture/" class="dropdown-item">架构设计文档</a>
</li>
                                    
<li>
    <a href="../../02_architecture/dcf_architecture/" class="dropdown-item">DCF 核心业务逻辑与架构</a>
</li>
                                    
<li>
    <a href="../../02_architecture/hybrid_architecture_design/" class="dropdown-item">股票估值系统混合架构设计文档</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">03 development</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../" class="dropdown-item">开发文档</a>
</li>
                                    
<li>
    <a href="../development_guide_2025_09/" class="dropdown-item">股票估值系统开发指南</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">测试策略与质量保障指南</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">04 deployment</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../04_deployment/" class="dropdown-item">部署运维文档</a>
</li>
                                    
<li>
    <a href="../../04_deployment/deployment_operations_guide_2025_09/" class="dropdown-item">部署运维指南</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">05 data sources</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../05_data_sources/" class="dropdown-item">数据源专题文档</a>
</li>
                                    
<li>
    <a href="../../05_data_sources/tushare_alignment/" class="dropdown-item">TuShare数据源对齐与生产部署报告</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Archived</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../archived/" class="dropdown-item">归档文档</a>
</li>
                                    
<li>
    <a href="../../archived/Stock_investment_decision_making_process/" class="dropdown-item">Stock investment decision making process</a>
</li>
                                    
<li>
    <a href="../../archived/api_backend_comprehensive_analysis/" class="dropdown-item">Stock Valuation API 后端接口详细分析文档</a>
</li>
                                    
<li>
    <a href="../../archived/dcf_industry_standards_comprehensive_analysis/" class="dropdown-item">DCF估值项目与行业标准深度对比分析报告</a>
</li>
                                    
<li>
    <a href="../../archived/dcf_optimization_plan/" class="dropdown-item">DCF 核心业务逻辑优化方案（v1）</a>
</li>
                                    
<li>
    <a href="../../archived/dcf_rolling_revaluation_guide/" class="dropdown-item">DCF 滚动重评实践指南（季度/中报更新版）</a>
</li>
                                    
<li>
    <a href="../../archived/directory_optimization_plan/" class="dropdown-item">项目目录结构优化方案</a>
</li>
                                    
<li>
    <a href="../../archived/mckinsey_financial_ratios_and_forecasting_analysis/" class="dropdown-item">Stock Vale Valuation 3.0 财务比率与预测逻辑 McKinsey 标准合规性专题分析报告</a>
</li>
                                    
<li>
    <a href="../../archived/mckinsey_standards_compliance_report/" class="dropdown-item">Stock Vale Valuation 3.0 项目 McKinsey 标准合规性分析报告</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../development_guide_2025_09/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../04_deployment/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#_1" class="nav-link">测试策略与质量保障指南</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#_2" class="nav-link">概述</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_3" class="nav-link">测试架构</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_6" class="nav-link">单元测试</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_15" class="nav-link">集成测试</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#api" class="nav-link">API测试</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_19" class="nav-link">端到端测试</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_20" class="nav-link">测试数据管理</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_21" class="nav-link">性能测试</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_24" class="nav-link">质量保障流程</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_26" class="nav-link">测试执行指南</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_30" class="nav-link">测试最佳实践</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_31" class="nav-link">测试覆盖率目标</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_35" class="nav-link">故障排查</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#_38" class="nav-link">未来规划</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="_1">测试策略与质量保障指南</h1>
<p><em>最后更新: 2025-09-22</em></p>
<h2 id="_2">概述</h2>
<p>本文档详细说明了股票估值系统的测试策略、质量保障流程和持续集成实践。项目目前拥有27个测试文件，覆盖单元测试、集成测试、API测试等多个层次。</p>
<h2 id="_3">测试架构</h2>
<h3 id="_4">测试分层策略</h3>
<pre><code>┌─────────────────────────────────────┐
│           E2E Tests                  │  ← 端到端测试
├─────────────────────────────────────┤
│          API Tests                   │  ← API接口测试
├─────────────────────────────────────┤
│       Integration Tests              │  ← 集成测试
├─────────────────────────────────────┤
│         Unit Tests                   │  ← 单元测试
└─────────────────────────────────────┘
</code></pre>
<h3 id="_5">测试目录结构</h3>
<pre><code>tests/
├── unit/                    # 单元测试
│   ├── core/               # 核心模块测试
│   ├── data/               # 数据层测试
│   └── services/           # 服务层测试
├── integration/            # 集成测试
├── api/                    # API测试
│   ├── test_main.py       # 主要API端点
│   ├── test_sensitivity.py # 敏感性分析
│   └── test_gdp_cap.py    # GDP上限测试
├── fixtures/               # 测试数据
└── conftest.py            # pytest配置
</code></pre>
<h2 id="_6">单元测试</h2>
<h3 id="_7">核心计算器测试</h3>
<h4 id="wacc">WACC计算器测试</h4>
<p><strong>文件</strong>: <code>tests/test_wacc_calculator.py</code></p>
<p><strong>测试覆盖</strong>:
- 基本WACC计算
- 边界条件(零值、负值)
- 不同资本结构场景
- 市场价值vs账面价值权重</p>
<pre><code class="language-python">def test_wacc_calculation_basic():
    &quot;&quot;&quot;测试基本WACC计算&quot;&quot;&quot;
    calculator = WaccCalculator()
    result = calculator.calculate_wacc(
        market_value_equity=Decimal('100'),
        market_value_debt=Decimal('50'),
        cost_of_equity=Decimal('0.12'),
        cost_of_debt=Decimal('0.06'),
        tax_rate=Decimal('0.25')
    )
    expected_wacc = Decimal('0.1')  # 10%
    assert abs(result.wacc - expected_wacc) &lt; Decimal('0.001')
</code></pre>
<h4 id="_8">现值计算器测试</h4>
<p><strong>文件</strong>: <code>tests/test_present_value_calculator.py</code></p>
<p><strong>测试覆盖</strong>:
- 现金流现值计算
- 终值现值计算
- 不同折现率场景
- Decimal精度验证</p>
<h4 id="_9">其他计算器测试</h4>
<ul>
<li><code>tests/test_fcf_calculator.py</code>: 自由现金流计算</li>
<li><code>tests/test_terminal_value_calculator.py</code>: 终值计算</li>
<li><code>tests/test_nwc_calculator.py</code>: 净营运资本计算</li>
<li><code>tests/test_equity_bridge_calculator.py</code>: 股权价值桥接</li>
</ul>
<h3 id="_10">数据处理测试</h3>
<h4 id="_11">财务预测器测试</h4>
<p><strong>文件</strong>: <code>tests/test_financial_forecaster.py</code></p>
<p><strong>测试覆盖</strong>:
- 收入预测算法
- 历史比率计算
- CAGR衰减逻辑
- 边界条件处理</p>
<h4 id="_12">数据处理器测试</h4>
<p><strong>文件</strong>: <code>tests/test_data_processor.py</code></p>
<p><strong>测试覆盖</strong>:
- 数据清洗逻辑
- 异常值检测
- 缺失值填充
- 历史比率计算</p>
<h3 id="_13">专项算法测试</h3>
<h4 id="_14">收入预测算法测试</h4>
<p><strong>文件群</strong>: <code>tests/test_enhanced_revenue_forecast*.py</code></p>
<p><strong>测试场景</strong>:
- 简单CAGR预测
- 带衰减的CAGR预测
- 过渡到目标值预测
- 数据库集成测试</p>
<pre><code class="language-python">def test_revenue_forecast_with_decay():
    &quot;&quot;&quot;测试带衰减的收入预测&quot;&quot;&quot;
    historical_revenues = [100, 120, 150, 180]
    forecaster = EnhancedRevenueForecast()

    projections = forecaster.project_revenue(
        historical_revenues=historical_revenues,
        forecast_years=5,
        decay_rate=0.1
    )

    # 验证预测逻辑
    assert len(projections) == 5
    assert all(p &gt; 0 for p in projections)
    # 验证衰减效应
    growth_rates = [projections[i]/projections[i-1] - 1
                   for i in range(1, len(projections))]
    assert all(growth_rates[i] &lt;= growth_rates[i-1]
              for i in range(1, len(growth_rates)))
</code></pre>
<h2 id="_15">集成测试</h2>
<h3 id="_16">完整估值流程测试</h3>
<p><strong>文件</strong>: <code>tests/test_sensitivity_analysis_integration.py</code></p>
<p><strong>测试覆盖</strong>:
- 数据获取→处理→计算→输出完整链路
- 多个股票代码测试
- 不同参数组合验证
- 错误处理流程</p>
<h3 id="_17">数据源集成测试</h3>
<p><strong>测试场景</strong>:
- TuShare API集成
- PostgreSQL数据库集成
- 数据源切换测试
- 缓存机制测试</p>
<h2 id="api">API测试</h2>
<h3 id="api_1">主要API端点测试</h3>
<p><strong>文件</strong>: <code>tests/api/test_main.py</code></p>
<p><strong>测试覆盖</strong>:
- <code>/api/v1/valuation</code> 估值接口
- 请求参数验证
- 响应格式验证
- 错误处理测试</p>
<pre><code class="language-python">@pytest.mark.asyncio
async def test_valuation_endpoint():
    &quot;&quot;&quot;测试估值API端点&quot;&quot;&quot;
    async with AsyncClient(app=app, base_url=&quot;http://test&quot;) as ac:
        response = await ac.post(&quot;/api/v1/valuation&quot;, json={
            &quot;ts_code&quot;: &quot;600519.SH&quot;,
            &quot;valuation_date&quot;: &quot;2025-09-22&quot;,
            &quot;forecast_years&quot;: 5
        })

    assert response.status_code == 200
    data = response.json()
    assert &quot;valuation_summary&quot; in data
    assert &quot;enterprise_value&quot; in data[&quot;valuation_summary&quot;]
    assert data[&quot;valuation_summary&quot;][&quot;enterprise_value&quot;] &gt; 0
</code></pre>
<h3 id="api_2">敏感性分析API测试</h3>
<p><strong>文件</strong>: <code>tests/api/test_sensitivity.py</code></p>
<p><strong>测试覆盖</strong>:
- 敏感性分析参数验证
- 多维度分析结果
- 输出格式验证
- 性能测试</p>
<h3 id="_18">特殊功能测试</h3>
<p><strong>文件</strong>: <code>tests/api/test_gdp_cap.py</code></p>
<p><strong>测试覆盖</strong>:
- GDP上限约束功能
- LTM基线功能
- 数据源切换功能</p>
<h2 id="_19">端到端测试</h2>
<h3 id="e2e">E2E测试脚本</h3>
<p><strong>工具</strong>: <code>scripts/e2e_compare_sources.py</code></p>
<p><strong>测试流程</strong>:
1. 配置测试环境
2. 运行完整估值流程
3. 对比不同数据源结果
4. 验证关键指标一致性
5. 生成测试报告</p>
<p><strong>使用方法</strong>:</p>
<pre><code class="language-bash"># 单股票E2E测试
python scripts/e2e_compare_sources.py --ts 600519.SH --date 2025-09-22

# 批量E2E测试
python scripts/e2e_compare_sources.py --batch --config test_stocks.json
</code></pre>
<h2 id="_20">测试数据管理</h2>
<h3 id="fixtures">测试夹具(Fixtures)</h3>
<p><strong>位置</strong>: <code>tests/fixtures/</code></p>
<p><strong>数据类型</strong>:
- 模拟财务报表数据
- 标准测试参数集
- 预期计算结果
- 错误场景数据</p>
<pre><code class="language-python"># conftest.py
@pytest.fixture
def sample_financial_data():
    &quot;&quot;&quot;提供标准测试用财务数据&quot;&quot;&quot;
    return {
        'income_statement': pd.DataFrame({
            'end_date': ['2021-12-31', '2022-12-31', '2023-12-31'],
            'revenue': [1000, 1200, 1500],
            'operate_profit': [150, 180, 225]
        }),
        'balance_sheet': pd.DataFrame({
            'end_date': ['2021-12-31', '2022-12-31', '2023-12-31'],
            'total_assets': [5000, 6000, 7500],
            'inventories': [200, 250, 300]
        })
    }
</code></pre>
<h3 id="mock">Mock数据策略</h3>
<ul>
<li><strong>外部API</strong>: Mock TuShare API调用</li>
<li><strong>数据库</strong>: 使用内存SQLite数据库</li>
<li><strong>文件系统</strong>: 使用临时目录</li>
<li><strong>网络请求</strong>: Mock HTTP响应</li>
</ul>
<h2 id="_21">性能测试</h2>
<h3 id="_22">基准测试</h3>
<p><strong>测试维度</strong>:
- 单次估值耗时
- 敏感性分析耗时
- 数据获取耗时
- 内存使用情况</p>
<h3 id="_23">压力测试</h3>
<p><strong>测试场景</strong>:
- 并发API请求
- 大批量股票筛选
- 长时间运行稳定性
- 内存泄漏检测</p>
<pre><code class="language-python">def test_valuation_performance():
    &quot;&quot;&quot;测试估值性能&quot;&quot;&quot;
    import time

    start_time = time.time()
    result = run_valuation(&quot;600519.SH&quot;, &quot;2025-09-22&quot;)
    end_time = time.time()

    execution_time = end_time - start_time
    assert execution_time &lt; 10.0  # 10秒内完成
    assert result is not None
</code></pre>
<h2 id="_24">质量保障流程</h2>
<h3 id="pre-commit">Pre-commit钩子</h3>
<p><strong>配置</strong>: <code>.pre-commit-config.yaml</code></p>
<p><strong>检查项目</strong>:
- 代码格式化(Black, isort)
- 静态分析(Ruff)
- 安全检查(Bandit)
- 测试执行(pytest)</p>
<h3 id="_25">持续集成</h3>
<p><strong>触发条件</strong>:
- 代码推送到主分支
- Pull Request创建/更新
- 定期调度(每日)</p>
<p><strong>CI流程</strong>:</p>
<pre><code class="language-yaml"># 示例GitHub Actions配置
name: CI
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.9
      - name: Install dependencies
        run: |
          pip install uv
          uv pip install -e &quot;.[dev,test]&quot;
      - name: Run tests
        run: pytest --cov=src --cov-report=xml
      - name: Upload coverage
        uses: codecov/codecov-action@v1
</code></pre>
<h2 id="_26">测试执行指南</h2>
<h3 id="_27">本地测试</h3>
<pre><code class="language-bash"># 运行所有测试
pytest

# 运行特定模块测试
pytest tests/test_wacc_calculator.py -v

# 运行API测试(需要异步支持)
pytest tests/api/ -v

# 运行覆盖率测试
pytest --cov=src --cov-report=html

# 运行性能测试
pytest tests/performance/ -v

# 跳过慢测试
pytest -m &quot;not slow&quot;
</code></pre>
<h3 id="_28">测试标记</h3>
<pre><code class="language-python"># 标记慢测试
@pytest.mark.slow
def test_long_running_process():
    pass

# 标记集成测试
@pytest.mark.integration
def test_database_integration():
    pass

# 标记API测试
@pytest.mark.api
def test_api_endpoint():
    pass
</code></pre>
<h3 id="_29">调试测试</h3>
<pre><code class="language-bash"># 详细输出
pytest -v -s

# 停在第一个失败
pytest -x

# 运行特定测试函数
pytest tests/test_wacc_calculator.py::test_basic_calculation -v

# 使用pdb调试
pytest --pdb
</code></pre>
<h2 id="_30">测试最佳实践</h2>
<h3 id="1">1. 测试命名规范</h3>
<ul>
<li>测试函数: <code>test_&lt;功能&gt;_&lt;场景&gt;</code></li>
<li>测试类: <code>Test&lt;模块名&gt;</code></li>
<li>测试文件: <code>test_&lt;模块名&gt;.py</code></li>
</ul>
<h3 id="2">2. 测试组织原则</h3>
<ul>
<li>一个测试只验证一个功能点</li>
<li>测试之间相互独立</li>
<li>使用描述性的断言消息</li>
<li>避免测试实现细节</li>
</ul>
<h3 id="3">3. 测试数据原则</h3>
<ul>
<li>使用最小化测试数据</li>
<li>避免硬编码魔法数字</li>
<li>使用工厂函数生成测试数据</li>
<li>清理测试产生的副作用</li>
</ul>
<h3 id="4-mock">4. Mock使用原则</h3>
<ul>
<li>Mock外部依赖而非内部逻辑</li>
<li>验证Mock调用参数</li>
<li>使用合理的Mock返回值</li>
<li>避免过度Mock</li>
</ul>
<h2 id="_31">测试覆盖率目标</h2>
<h3 id="_32">当前覆盖率状态</h3>
<ul>
<li><strong>总体覆盖率</strong>: ~47%</li>
<li><strong>核心计算模块</strong>: &gt;80%</li>
<li><strong>API层</strong>: &gt;70%</li>
<li><strong>数据层</strong>: &gt;60%</li>
</ul>
<h3 id="_33">覆盖率提升计划</h3>
<ol>
<li><strong>第一阶段</strong>(目标80%):</li>
<li>补充数据处理模块测试</li>
<li>完善异常处理测试</li>
<li>
<p>增加边界条件测试</p>
</li>
<li>
<p><strong>第二阶段</strong>(目标90%):</p>
</li>
<li>补充集成测试</li>
<li>增加性能测试</li>
<li>完善E2E测试</li>
</ol>
<h3 id="_34">覆盖率监控</h3>
<pre><code class="language-bash"># 生成覆盖率报告
pytest --cov=src --cov-report=html --cov-report=term

# 查看详细覆盖率
coverage report -m

# 查看未覆盖代码
coverage html
open htmlcov/index.html
</code></pre>
<h2 id="_35">故障排查</h2>
<h3 id="_36">常见测试问题</h3>
<h4 id="1_1">1. 异步测试失败</h4>
<pre><code class="language-bash"># 确保安装pytest-asyncio
pip install pytest-asyncio

# 检查async标记
@pytest.mark.asyncio
async def test_async_function():
    pass
</code></pre>
<h4 id="2_1">2. 数据库测试失败</h4>
<pre><code class="language-bash"># 检查测试数据库配置
export TEST_DATABASE_URL=&quot;sqlite:///test.db&quot;

# 清理测试数据
pytest --setup-show
</code></pre>
<h4 id="3-mock">3. Mock未生效</h4>
<pre><code class="language-python"># 确保Mock路径正确
@patch('src.data.fetchers.tushare_fetcher.TushareAshareFetcher')
def test_with_mock(mock_fetcher):
    pass
</code></pre>
<h3 id="_37">测试环境隔离</h3>
<ul>
<li>使用独立的测试数据库</li>
<li>清理测试产生的文件</li>
<li>重置全局状态</li>
<li>避免测试间依赖</li>
</ul>
<h2 id="_38">未来规划</h2>
<h3 id="1_2">短期目标(1个月)</h3>
<ul>
<li>提升覆盖率到80%</li>
<li>完善API测试套件</li>
<li>增加性能基准测试</li>
<li>优化测试执行速度</li>
</ul>
<h3 id="3_1">中期目标(3个月)</h3>
<ul>
<li>实现自动化回归测试</li>
<li>建立测试数据管理平台</li>
<li>增加契约测试</li>
<li>完善监控和告警</li>
</ul>
<h3 id="6">长期目标(6个月)</h3>
<ul>
<li>实现测试驱动开发(TDD)</li>
<li>建立测试质量度量体系</li>
<li>实现智能测试选择</li>
<li>完善测试文档和培训</li>
</ul>
<hr />
<p><em>测试是保证代码质量的重要手段，建议所有开发者严格遵循本测试策略进行开发。</em></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
